<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>„Å≤„Åã„Çä„ÅÆÂ≠êÔºöÂÖâ„ÇíÂèñ„ÇäÊàª„ÅôÊóÖ</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            width: 100%;
            height: 100vh;
            overflow: hidden;
            background: #000;
        }

        #gameContainer {
            width: 100%;
            height: 100%;
            position: relative;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        /* ========== „Ç≠„É£„É≥„Éê„Çπ ========== */
        canvas {
            display: block;
            width: 100%;
            height: 100%;
        }

        /* ========== „Ç™„Éº„Éê„Éº„É¨„Ç§UI ========== */
        #overlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
        }

        /* ========== ‰∏äÈÉ®UI ========== */
        #topUI {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            padding: 20px;
            pointer-events: auto;
        }

        /* Â∑¶ÔºöÂ≠ê„Å©„ÇÇ„ÅÆÁä∂ÊÖã */
        #childStatus {
            background: rgba(0, 0, 0, 0.7);
            padding: 20px;
            border-radius: 10px;
            color: #fff;
            font-size: 14px;
            max-width: 250px;
            line-height: 1.8;
        }

        #childStatus h3 {
            font-size: 16px;
            margin-bottom: 10px;
            color: #ffd700;
        }

        #childStatus p {
            margin: 5px 0;
            color: #e0e0e0;
        }

        /* Âè≥ÔºöÈÄ≤Ë°åÂ∫¶ */
        #progressInfo {
            background: rgba(0, 0, 0, 0.7);
            padding: 20px;
            border-radius: 10px;
            color: #fff;
            font-size: 14px;
            text-align: right;
            max-width: 200px;
        }

        #progressInfo h4 {
            font-size: 16px;
            margin-bottom: 10px;
            color: #ffd700;
        }

        /* ========== ‰∏≠Â§Æ„ÅÆ„ÉÜ„Ç≠„Çπ„Éà ========== */
        #centerText {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            text-align: center;
            color: #fff;
            max-width: 80%;
            pointer-events: auto;
            z-index: 100;
        }

        #centerText h2 {
            font-size: 28px;
            margin-bottom: 20px;
            color: #ffd700;
            text-shadow: 0 0 10px rgba(255, 215, 0, 0.5);
        }

        #centerText p {
            font-size: 18px;
            margin-bottom: 30px;
            line-height: 1.6;
            color: #e0e0e0;
        }

        /* ========== ‰∏ãÈÉ®ÔºöÈÅ∏ÊäûËÇ¢„Éú„Çø„É≥ ========== */
        #buttonsContainer {
            display: flex;
            flex-direction: column;
            gap: 15px;
            padding: 30px;
            pointer-events: auto;
            max-width: 600px;
            margin: 0 auto;
        }

        .choiceBtn {
            padding: 18px 20px;
            font-size: 16px;
            border: 2px solid #ffd700;
            background: rgba(0, 0, 0, 0.8);
            color: #ffd700;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: left;
            line-height: 1.5;
        }

        .choiceBtn:hover {
            background: rgba(255, 215, 0, 0.2);
            transform: translateX(10px);
            box-shadow: 0 0 15px rgba(255, 215, 0, 0.5);
        }

        .choiceBtn:active {
            transform: translateX(5px);
        }

        .choiceBtn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        /* ========== „Çø„Ç§„Éà„É´ÁîªÈù¢ ========== */
        #titleScreen {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, #1a0033 0%, #0a0015 100%);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 1000;
            pointer-events: auto;
        }

        #titleScreen.hidden {
            display: none;
            pointer-events: none;
        }

        #titleContent {
            text-align: center;
            color: #fff;
        }

        #titleContent h1 {
            font-size: 48px;
            margin-bottom: 10px;
            color: #ffd700;
            text-shadow: 0 0 20px rgba(255, 215, 0, 0.7);
            animation: pulse 2s infinite;
        }

        #titleContent p {
            font-size: 18px;
            margin-bottom: 40px;
            color: #e0e0e0;
        }

        #startBtn {
            padding: 20px 50px;
            font-size: 20px;
            border: 2px solid #ffd700;
            background: rgba(255, 215, 0, 0.1);
            color: #ffd700;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s ease;
            text-shadow: 0 0 10px rgba(255, 215, 0, 0.5);
        }

        #startBtn:hover {
            background: rgba(255, 215, 0, 0.3);
            box-shadow: 0 0 20px rgba(255, 215, 0, 0.7);
            transform: scale(1.05);
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.7; }
        }

        /* ========== „Ç®„É≥„Éá„Ç£„É≥„Ç∞ÁîªÈù¢ ========== */
        #endingScreen {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, #003366 0%, #000033 100%);
            display: none;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 1001;
            pointer-events: auto;
            color: #fff;
            text-align: center;
            padding: 40px;
        }

        #endingScreen.show {
            display: flex;
        }

        #endingContent h2 {
            font-size: 36px;
            margin-bottom: 30px;
            color: #ffd700;
            text-shadow: 0 0 20px rgba(255, 215, 0, 0.7);
        }

        #endingContent p {
            font-size: 18px;
            line-height: 2;
            margin-bottom: 30px;
            color: #e0e0e0;
            max-width: 600px;
        }

        #restartBtn {
            padding: 20px 50px;
            font-size: 18px;
            border: 2px solid #ffd700;
            background: rgba(255, 215, 0, 0.1);
            color: #ffd700;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-top: 20px;
        }

        #restartBtn:hover {
            background: rgba(255, 215, 0, 0.3);
            box-shadow: 0 0 20px rgba(255, 215, 0, 0.7);
        }

        /* ========== „É¨„Çπ„Éù„É≥„Ç∑„Éñ ========== */
        @media (max-width: 768px) {
            #topUI {
                flex-direction: column;
                gap: 15px;
            }

            #childStatus, #progressInfo {
                max-width: 100%;
                font-size: 12px;
                padding: 15px;
            }

            #centerText h2 {
                font-size: 20px;
            }

            #centerText p {
                font-size: 16px;
            }

            .choiceBtn {
                padding: 15px;
                font-size: 14px;
            }

            #titleContent h1 {
                font-size: 32px;
            }

            #titleContent p {
                font-size: 14px;
            }

            #startBtn {
                padding: 15px 30px;
                font-size: 16px;
            }
        }

        @media (max-width: 480px) {
            #topUI {
                padding: 10px;
            }

            #centerText {
                max-width: 90%;
            }

            #centerText h2 {
                font-size: 18px;
            }

            #centerText p {
                font-size: 14px;
            }

            .choiceBtn {
                padding: 12px;
                font-size: 12px;
            }

            #buttonsContainer {
                padding: 15px;
            }
        }
    </style>
</head>
<body>
    <div id="gameContainer">
        <canvas id="gameCanvas"></canvas>
        
        <!-- „Çø„Ç§„Éà„É´ÁîªÈù¢ -->
        <div id="titleScreen">
            <div id="titleContent">
                <h1>‚ú® „Å≤„Åã„Çä„ÅÆÂ≠ê ‚ú®</h1>
                <p>ÂÖâ„ÇíÂèñ„ÇäÊàª„ÅôÊóÖ</p>
                <p style="font-size: 14px; color: #aaa; margin-top: 20px;">
                    ÈÅéÂéª„ÅÆËá™ÂàÜ„Å®Âêë„ÅçÂêà„ÅÑ„ÄÅÂøÉ„ÇíÁôí„Åô‰ΩìÈ®ì
                </p>
                <button id="startBtn">ÊóÖ„ÇíÂßã„ÇÅ„Çã</button>
            </div>
        </div>

        <!-- „Ç≤„Éº„É†„Ç™„Éº„Éê„Éº„É¨„Ç§ -->
        <div id="overlay">
            <!-- ‰∏äÈÉ®UI -->
            <div id="topUI">
                <div id="childStatus">
                    <h3>üëß Â≠ê„Å©„ÇÇ„ÅÆÁä∂ÊÖã</h3>
                    <p id="statusText">Ê∫ñÂÇô‰∏≠...</p>
                </div>
                <div id="progressInfo">
                    <h4>üìç ÈÄ≤Ë°åÁä∂Ê≥Å</h4>
                    <p id="locationName">-</p>
                    <p id="progressPercent">0/10</p>
                </div>
            </div>

            <!-- ‰∏≠Â§Æ„ÉÜ„Ç≠„Çπ„Éà -->
            <div id="centerText">
                <h2 id="dialogTitle">-</h2>
                <p id="dialogText">-</p>
            </div>

            <!-- ‰∏ãÈÉ®„Éú„Çø„É≥ -->
            <div id="buttonsContainer">
                <button class="choiceBtn" data-choice="0" disabled>‚ë†</button>
                <button class="choiceBtn" data-choice="1" disabled>‚ë°</button>
                <button class="choiceBtn" data-choice="2" disabled>‚ë¢</button>
            </div>
        </div>

        <!-- „Ç®„É≥„Éá„Ç£„É≥„Ç∞ÁîªÈù¢ -->
        <div id="endingScreen">
            <div id="endingContent">
                <h2>üåÖ ÊóÖ„ÅÆÁµÇ„Çè„Çä üåÖ</h2>
                <p id="endingMessage">-</p>
                <button id="restartBtn">„ÇÇ„ÅÜ‰∏ÄÂ∫¶ÊóÖ„Åô„Çã</button>
            </div>
        </div>
    </div>

    <script>
        // ========== „Ç≤„Éº„É†ÂÖ®‰Ωì„ÅÆÁä∂ÊÖãÁÆ°ÁêÜ ==========
        const gameState = {
            started: false,
            currentStage: 0,
            totalStages: 10,
            childLightAmount: 0, // 0-100: Â≠ê„Å©„ÇÇ„ÅÆÂÖâ„ÅÆÈáè
            playerChoice: null,
            canChoose: false,
            gameEnded: false
        };

        // ========== „Çπ„ÉÜ„Éº„Ç∏„Éá„Éº„Çø ==========
        const stages = [
            {
                name: "Èúß„ÅÆÊ£Æ",
                emotion: "Ëø∑„ÅÑ",
                childMessage: "„Å≠„Åà... „Å≠„Åà...\n„Å©„Åì„Å´„ÅÑ„Çã„ÅÆÔºü\nÁßÅ„ÇíÁΩÆ„ÅçÂéª„Çä„Å´„Åó„Å™„ÅÑ„Åß...",
                question: "„Åì„ÅÆÂ≠ê„ÅØ‰Ωï„ÇíÊ±Ç„ÇÅ„Å¶„ÅÑ„Çã„Å®ÊÄù„ÅÑ„Åæ„Åô„ÅãÔºü",
                choices: [
                    { text: "‚ë† Ëø∑„Å£„Å¶„Çã„Çì„Å†", response: "„Åù„ÅÜ... Ë™∞„ÇÇ„ÅÑ„Å™„Åè„Å¶ÊÄñ„Åã„Å£„Åü„Çì„Å†„ÄÇ„Åß„ÇÇ„ÄÅ„ÅÇ„Å™„Åü„ÅåË¶ã„Å§„Åë„Å¶„Åè„Çå„Åü„ÄÇ„ÅÇ„Çä„Åå„Å®„ÅÜ„ÄÇ", impact: 15 },
                    { text: "‚ë° Â≠§Áã¨„ÇíÊÑü„Åò„Å¶„Çã„Çì„Å†", response: "„ÅÜ„Çì... „Åö„Å£„Å®Ë™∞„ÇÇ„ÅÑ„Å™„Åè„Å¶„ÄÇ„Åß„ÇÇ„ÄÅ„ÅÇ„Å™„Åü„Åå‰∏ÄÁ∑í„Å´„ÅÑ„Å¶„Åè„Çå„Çã„Çì„Å†„ÄÇ", impact: 20 },
                    { text: "‚ë¢ Ëá™ÂàÜ„ÅÆÂ†¥ÊâÄ„ÇíÊé¢„Åó„Å¶„Çã„Çì„Å†", response: "„Åù„Å£„Åã... ÁßÅ„ÅÆÂ†¥ÊâÄ... „Å©„Åì„Å´„ÅÇ„Çã„ÅÆ„Åã„Å™„ÄÇ", impact: 10 }
                ],
                bgColor: "#2a1f4d",
                lightColor: "#4a3f7d"
            },
            {
                name: "Áü≥„ÅÆÊ©ã",
                emotion: "ÊÅê„Çå",
                childMessage: "„Åì... ÊÄñ„ÅÑ...\nÊ©ã„ÅåÂ£ä„Çå„Å¶„Çã...\nËêΩ„Å°„Åü„Çâ„Å©„ÅÜ„Åó„Çà„ÅÜ...",
                question: "„Åì„ÅÆÂ≠ê„ÅØÊú¨ÂΩì„ÅØ‰Ωï„ÇíÊÄñ„Çå„Å¶„ÅÑ„Åæ„Åô„ÅãÔºü",
                choices: [
                    { text: "‚ë† Â§±Êïó„Åô„Çã„Åì„Å®„ÅåÊÄñ„ÅÑ„Çì„Å†", response: "Â§±Êïó„Åã... „Åù„Å£„Åã„ÄÇÊñ∞„Åó„ÅÑÂ†¥ÊâÄ„Å∏ÈÄ≤„ÇÄ„ÅÆ„ÅåÊÄñ„Åã„Å£„Åü„Çì„Å†„ÄÇ", impact: 12 },
                    { text: "‚ë° ‰∏Ä‰∫∫„ÅßÈÄ≤„ÇÄ„ÅÆ„ÅåÊÄñ„ÅÑ„Çì„Å†", response: "‰∏Ä‰∫∫„Åß... „Åß„ÇÇ„ÄÅ‰ªä„ÅØ„ÅÇ„Å™„Åü„Åå„ÅÑ„Çã„Çì„Å†„ÄÇÊâã„ÇíÊè°„Å£„Å¶„ÇÇ„Çâ„Åà„ÇãÔºü", impact: 25 },
                    { text: "‚ë¢ Áü•„Çâ„Å™„ÅÑÂ†¥ÊâÄ„Å∏ÈÄ≤„ÇÄ„ÅÆ„ÅåÊÄñ„ÅÑ„Çì„Å†", response: "Áü•„Çâ„Å™„ÅÑ... „Åß„ÇÇ„ÄÅ„Åì„Çå„Åã„Çâ„ÅØ‰∏ÄÁ∑í„Å†„Åã„ÇâÂ§ß‰∏àÂ§´„ÄÇ", impact: 18 }
                ],
                bgColor: "#3f3a2f",
                lightColor: "#6f6a5f"
            },
            {
                name: "ÂÜ∑„Åü„ÅÑÊπñ",
                emotion: "ÂæåÊÇî",
                childMessage: "„Åì„Çå... ÁßÅÔºü\nÈÜú„ÅÑ...\nË™∞„ÇÇÊÑõ„Åï„Å™„ÅÑ...",
                question: "Ê∞¥„Å´Êò†„Å£„ÅüËá™ÂàÜ„Çí„ÄÅ„Å©„ÅÜÊÑü„Åò„Å¶„ÅÑ„Åæ„Åô„ÅãÔºü",
                choices: [
                    { text: "‚ë† „Åù„ÅÆ„Åæ„Åæ„Åß„ÅÑ„ÅÑ„Çì„Å†", response: "Êú¨ÂΩìÔºü „Åù„ÅÆ„Åæ„Åæ„Åß... „ÅÑ„ÅÑ„Çì„Å†„ÄÇ", impact: 22 },
                    { text: "‚ë° „Åù„ÅÆÂ≠ê„ÇÇÁ¥†Êïµ„Å™‰∏ÄÈÉ®„Å™„Çì„Å†", response: "Á¥†Êïµ... ‰∏ÄÈÉ®... ÂÖ®ÈÉ®„ÅåÁßÅ„Å™„Çì„Å†„ÄÇ", impact: 28 },
                    { text: "‚ë¢ ÊôÇÈñì„ÅåÂÖ®„Å¶„ÇíÁôí„Åô", response: "ÊôÇÈñì„Åå... „Åù„Å£„Åã„ÄÇÂ∞ë„Åó„Åö„Å§Â§â„Çè„Çã„Çì„Å†„ÄÇ", impact: 16 }
                ],
                bgColor: "#1a3a4a",
                lightColor: "#3a5a7a"
            },
            {
                name: "ÁÑ¶„Åí„Åü‰∏ò",
                emotion: "ÊÄí„Çä",
                childMessage: "Ë®±„Åï„Å™„ÅÑÔºÅ\n„Å™„Åú„Åì„Çì„Å™„Å´...\nË™∞„ÅåÊÇ™„ÅÑÔºÅ",
                question: "„Åù„ÅÆÊÄí„Çä„ÅÆÊ≠£‰Ωì„ÅØ‰Ωï„Å†„Å®ÊÄù„ÅÑ„Åæ„Åô„ÅãÔºü",
                choices: [
                    { text: "‚ë† ÊÑõ„Åï„Çå„Åü„ÅÑÊ∞óÊåÅ„Å°„Å™„Çì„Å†", response: "ÊÑõ„Åï„Çå„Åü„ÅÑ... „Åù„Å£„Åã„ÄÇÊÑõ„Åó„Å¶„Åª„Åó„Åã„Å£„Åü„Çì„Å†„ÄÇÊ≥£„Åç„Åü„ÅÑ„ÄÇ", impact: 30 },
                    { text: "‚ë° ÂÇ∑„Å§„ÅÑ„ÅüÂøÉ„Å™„Çì„Å†", response: "ÂÇ∑„Å§„ÅÑ„Åü... Ê≥£„Åç„Åü„Åè„Å™„Å£„Åü„ÄÇ„Åß„ÇÇ„ÄÅ„ÅÇ„Å™„Åü„Åå„ÅÑ„Å¶„Åè„Çå„Çã„ÄÇ", impact: 24 },
                    { text: "‚ë¢ Ëá™ÂàÜ„ÇíÂÆà„Çç„ÅÜ„Å®„Åó„Å¶„Åü„Çì„Å†", response: "ÂÆà„Çç„ÅÜ... „Åù„Å£„Åã„ÄÇËá™ÂàÜ„ÇíÂÆà„Çç„ÅÜ„Å®„Åó„Å¶„Åü„Çì„Å†„ÄÇ", impact: 18 }
                ],
                bgColor: "#4a2a1a",
                lightColor: "#8a5a3a"
            },
            {
                name: "Âè§„ÅÑÂÆ∂",
                emotion: "Âñ™Â§±",
                childMessage: "„Åì„Åì„Å´„ÅÑ„Åü„Åë„Å©...\n„ÇÇ„ÅÜË™∞„ÇÇ„ÅÑ„Å™„ÅÑ...\nÂÖ®ÈÉ®„Å™„Åè„Å™„Å£„Åü...",
                question: "Â§±„Å£„Åü„ÇÇ„ÅÆ„Åß„ÄÅÂ§ßÂàá„Å†„Å£„Åü„ÅÆ„ÅØ‰Ωï„Åß„Åô„ÅãÔºü",
                choices: [
                    { text: "‚ë† ÊÄù„ÅÑÂá∫„Åù„ÅÆ„ÇÇ„ÅÆ", response: "ÊÄù„ÅÑÂá∫„ÅØ... ÂøÉ„ÅÆ‰∏≠„Å´ÊÆã„Å£„Å¶„Çã„Çì„Å†„ÄÇÂÖâ„Å´„Å™„Å£„Å¶ÊÆã„Å£„Å¶„Çã„ÄÇ", impact: 26 },
                    { text: "‚ë° ÊÑõ„Åï„Çå„Å¶„ÅüÊôÇÈñì", response: "ÊÑõ„Åï„Çå„Å¶„ÅüÊôÇÈñì... „Åù„Çå„ÅØÁµ∂ÂØæ„Å´„Å™„Åè„Å™„Çâ„Å™„ÅÑ„ÄÇÁßÅ„ÅÆ‰∏≠„Å´„ÄÇ", impact: 28 },
                    { text: "‚ë¢ ÂÆâÂøÉ„Å®Â±ÖÂ†¥ÊâÄ", response: "ÂÆâÂøÉ... „Åß„ÇÇ„ÄÅ„ÅÇ„Å™„Åü„Å®‰∏ÄÁ∑í„Å´„ÅÑ„Çã„Å®„ÄÅÂÆâÂøÉ„Åô„Çã„ÄÇ", impact: 20 }
                ],
                bgColor: "#3a3a3a",
                lightColor: "#5a5a5a"
            },
            {
                name: "Ëä±„ÅÆÂ∫≠",
                emotion: "Êáê„Åã„Åó„Åï",
                childMessage: "Á∂∫È∫ó„Å†„Å≠...\nÊáê„Åã„Åó„ÅÑ...\n„ÅÑ„Å§„ÅãË¶ã„ÅüËä±...",
                question: "„Åù„ÅÆÊáê„Åã„Åó„Åï„ÅØ‰Ωï„Çí„ÅÇ„Å™„Åü„Å´Êïô„Åà„Å¶„Åè„Çå„Åæ„Åô„ÅãÔºü",
                choices: [
                    { text: "‚ë† ÂÑ™„Åó„Åï„ÅåÂ≠òÂú®„Åó„Å¶„Åü„Åì„Å®", response: "ÂÑ™„Åó„Åï... „ÅÇ„ÅÇ„ÄÇÂÑ™„Åó„ÅÑÊôÇÈñì„Åå„ÅÇ„Å£„Åü„Çì„Å†„ÄÇ", impact: 22 },
                    { text: "‚ë° Ëá™ÂàÜ„ÅØÊÑõ„Åï„Çå„ÇãÂ≠òÂú®„Å†„Å£„Åü„Åì„Å®", response: "ÊÑõ„Åï„Çå„Çã... „Åù„Å£„Åã„ÄÇÊòî„ÅÆÁßÅ„ÅØÂ§ßÂàá„Å´„Åï„Çå„Å¶„Åü„Çì„Å†„ÄÇ", impact: 29 },
                    { text: "‚ë¢ ÂÖ®„Å¶„ÅØÂ§±„Çè„Çå„Å¶„ÅÑ„Å™„ÅÑ„Åì„Å®", response: "Â§±„Çè„Çå„Å¶„Å™„ÅÑ... „Åù„Å£„Åã„ÄÇÂøÉ„ÅÆ‰∏≠„Å´ÂÖ®ÈÉ®„ÅÇ„Çã„ÄÇ", impact: 24 }
                ],
                bgColor: "#2a4a2a",
                lightColor: "#5a8a5a"
            },
            {
                name: "È¢®„ÅÆÂùÇÈÅì",
                emotion: "ÂèóÂÆπ",
                childMessage: "ÊÑü„Åò„Çã„Å≠...\n‰Ωï„Åã„ÅåÂ§â„Çè„Å£„Åü...\nÊÄñ„Åè„Å™„ÅÑ...",
                question: "„Åù„ÅÆÂ§âÂåñ„Çí„ÄÅ„Å©„ÅÜÂèó„ÅëÂÖ•„Çå„Åæ„Åô„ÅãÔºü",
                choices: [
                    { text: "‚ë† ÂÖ®ÈÉ®„ÅåËá™ÂàÜ„ÅÆ‰∏ÄÈÉ®„Å†„Åã„Çâ", response: "ÂÖ®ÈÉ®... ÁßÅ„ÅÆ‰∏ÄÈÉ®„ÄÇÁ∂∫È∫ó„Å™„ÅÆ„ÇÇ„ÄÅÊ±ö„ÅÑ„ÅÆ„ÇÇ„ÄÅÂÖ®ÈÉ®„ÅåÁßÅ„ÄÇ", impact: 27 },
                    { text: "‚ë° ÊôÇÈñì„ÅåÂÖ®„Å¶Áôí„Åó„Å¶„Åè„Çå„Çã„Åã„Çâ", response: "ÊôÇÈñì„Åå... „Åù„Å£„Åã„ÄÇÊ≠©„Çì„Åß„ÅÑ„Åè„Å†„Åë„Åß„ÅÑ„ÅÑ„Çì„Å†„ÄÇ", impact: 20 },
                    { text: "‚ë¢ ‰ªä„ÅÆ„ÅÇ„Å™„Åü„ÅåÂÆåÁíß„Å†„Åã„Çâ", response: "ÂÆåÁíß... „ÅÇ„ÅÇ„ÄÇ‰ªä„ÅÆ„Åì„ÅÆÂßø„Åß„ÄÅ„ÅÑ„ÅÑ„Çì„Å†„ÄÇ", impact: 25 }
                ],
                bgColor: "#2a3a1a",
                lightColor: "#5a7a3a"
            },
            {
                name: "Êòü„ÅÆÂπ≥Âéü",
                emotion: "Â∏åÊúõ",
                childMessage: "ÂÖâ„Å†...\nÊòü„Å†...\nÂ∏åÊúõ...",
                question: "„Åù„ÅÆÂ∏åÊúõ„ÅØ‰Ωï„ÅåÁîü„ÅøÂá∫„Åó„Åæ„Åó„Åü„ÅãÔºü",
                choices: [
                    { text: "‚ë† „ÅÇ„Å™„Åü„Åå‰∏ÄÁ∑í„Å´„ÅÑ„Çã„Åã„Çâ", response: "‰∏ÄÁ∑í... „ÅÇ„ÅÇ„ÄÇ„Åö„Å£„Å®‰∏ÄÁ∑í„Å™„Çì„Å†„ÄÇ„ÇÇ„ÅÜÊÄñ„Åè„Å™„ÅÑ„ÄÇ", impact: 31 },
                    { text: "‚ë° ÈÅéÂéª„ÇíÂèó„ÅëÂÖ•„Çå„Åü„Åã„Çâ", response: "Âèó„ÅëÂÖ•„Çå„Åü... „Åù„Å£„Åã„ÄÇÂÖ®ÈÉ®„ÅåÂÖâ„Å´Â§â„Çè„Å£„Åü„ÄÇ", impact: 28 },
                    { text: "‚ë¢ Êú™Êù•„ÅØ„Åæ„Å†ÁôΩÁ¥ô„Å†„Åã„Çâ", response: "ÁôΩÁ¥ô... „Åì„Çå„Åã„Çâ„ÅØËá™ÂàÜ„ÅßÊèè„Åë„Çã„Çì„Å†„ÄÇ", impact: 26 }
                ],
                bgColor: "#1a1a3a",
                lightColor: "#4a4a8a"
            },
            {
                name: "ÂÖâ„ÅÆÂ°î",
                emotion: "Áµ±Âêà",
                childMessage: "„Åì„Åì„Å†...\n„Åì„Åì„ÅåÁßÅ„ÅÆÂ†¥ÊâÄ...\nÂ∏∞„Å£„Å¶„Åç„Åü...",
                question: "„Åì„ÅÆÁû¨Èñì„ÄÅ‰Ωï„ÅåÂÆåÊàê„Åó„Åæ„Åó„Åü„ÅãÔºü",
                choices: [
                    { text: "‚ë† Ëá™ÂàÜËá™Ë∫´„ÅÆÁµ±Âêà", response: "Áµ±Âêà... ÂÖ®„Å¶„ÅÆÁßÅ„Åå„ÄÅ„Åì„Åì„Å´„ÄÇ„Éê„É©„Éê„É©„Åò„ÇÉ„Å™„ÅÑ„ÄÇ", impact: 35 },
                    { text: "‚ë° Ëá™Â∑±ÂèóÂÆπ„ÅÆÂÆåÊàê", response: "Âèó„ÅëÂÖ•„Çå„Åü... ÂÖ®ÈÉ®„ÇíÂèó„ÅëÂÖ•„Çå„Åü„ÄÇÊÑõ„Åä„Åó„ÅÑ„ÄÇ", impact: 33 },
                    { text: "‚ë¢ Êñ∞„Åó„ÅÑÊóÖ„ÅÆÂßã„Åæ„Çä", response: "Êñ∞„Åó„ÅÑÊóÖ... „ÅÇ„ÅÇ„ÄÇ„Åì„Çå„Åã„Çâ„ÅåÊú¨ÂΩì„ÅÆÂßã„Åæ„Çä„ÄÇ", impact: 32 }
                ],
                bgColor: "#3a2a1a",
                lightColor: "#8a6a3a"
            },
            {
                name: "ÊúùÁÑº„Åë„ÅÆ‰∏ò",
                emotion: "ÂÜçÁîü",
                childMessage: "„ÅÇ„Çä„Åå„Å®„ÅÜ...\n„ÇÇ„ÅÜÂ§ß‰∏àÂ§´...\n„ÅÇ„Å™„Åü„Å®‰∏ÄÁ∑í„Å™„Çâ...",
                question: "„Åì„ÅÆÂÖà„ÄÅ‰Ωï„Çí„Åó„Åæ„Åô„ÅãÔºü",
                choices: [
                    { text: "‚ë† „ÅÇ„Å™„Åü„Å®‰∏ÄÁ∑í„Å´Ê≠©„Çì„Åß„ÅÑ„Åè", response: "‰∏ÄÁ∑í... „ÅÇ„ÅÇ„ÄÇ„Åö„Å£„Å®‰∏ÄÁ∑í„ÄÇ„ÇÇ„ÅÜÈõ¢„Çå„Å™„ÅÑ„ÄÇ", impact: 40 },
                    { text: "‚ë° Êñ∞„Åó„ÅÑÂÖâ„ÇíÊé¢„ÅóÁ∂ö„Åë„Çã", response: "Êñ∞„Åó„ÅÑÂÖâ... „Åù„Çå„ÅØ„ÅÇ„Å™„Åü„ÅÆ‰∏≠„Å´„ÅÇ„Çã„Çì„Å†„ÄÇ", impact: 38 },
                    { text: "‚ë¢ ‰ªä„ÇíÂ§ßÂàá„Å´Áîü„Åç„Çã", response: "‰ªä... „ÅÇ„ÅÇ„ÄÇ„Åì„ÅÆÁû¨Èñì„ÅåÂÖ®„Å¶„Å™„Çì„Å†„ÄÇ", impact: 36 }
                ],
                bgColor: "#4a1a0a",
                lightColor: "#ff6a3a"
            }
        ];

        // ========== UIÊõ¥Êñ∞Èñ¢Êï∞ ==========
        function updateUI() {
            const stage = stages[gameState.currentStage];
            const percent = Math.round((gameState.childLightAmount / 100) * 100);

            // Â≠ê„Å©„ÇÇ„ÅÆÁä∂ÊÖã
            const statusTexts = [
                "üò¢ Ê≥£„ÅÑ„Å¶„ÅÑ„Çã",
                "üòü ‰∏çÂÆâ„ÇíÊÑü„Åò„Å¶„ÅÑ„Çã",
                "üòê ËêΩ„Å°ÁùÄ„ÅçÂßã„ÇÅ„Åü",
                "üôÇ ÂÆâÂøÉ„Åó„Å¶„ÅÑ„Çã",
                "‚ú® ÂÖâ„Å´ÂåÖ„Åæ„Çå„Å¶„ÅÑ„Çã"
            ];

            let statusIndex = 0;
            if (percent >= 80) statusIndex = 4;
            else if (percent >= 60) statusIndex = 3;
            else if (percent >= 40) statusIndex = 2;
            else if (percent >= 20) statusIndex = 1;

            document.getElementById("statusText").textContent = statusTexts[statusIndex];
            document.getElementById("locationName").textContent = stage.name + " - " + stage.emotion;
            document.getElementById("progressPercent").textContent = (gameState.currentStage + 1) + "/10";

            // „ÉÄ„Ç§„Ç¢„É≠„Ç∞
            document.getElementById("dialogTitle").textContent = "üëß " + stage.name;
            document.getElementById("dialogText").textContent = stage.childMessage;

            // ÈÅ∏ÊäûËÇ¢
            const buttons = document.querySelectorAll(".choiceBtn");
            buttons.forEach((btn, idx) => {
                if (idx < stage.choices.length) {
                    btn.textContent = stage.choices[idx].text;
                    btn.disabled = false;
                } else {
                    btn.textContent = "";
                    btn.disabled = true;
                }
            });
        }

        // ========== „Çπ„ÉÜ„Éº„Ç∏ÈÄ≤Ë°å ==========
        function startStage() {
            gameState.canChoose = true;
            gameState.playerChoice = null;
            updateUI();
        }

        function makeChoice(choiceIndex) {
            if (!gameState.canChoose || gameState.playerChoice !== null) return;

            gameState.canChoose = false;
            gameState.playerChoice = choiceIndex;

            const stage = stages[gameState.currentStage];
            const choice = stage.choices[choiceIndex];

            // ÂÖâ„ÇíÂ¢ó„ÇÑ„Åô
            gameState.childLightAmount = Math.min(100, gameState.childLightAmount + choice.impact);

            // ÂèçÂøú„ÇíË°®Á§∫
            document.getElementById("dialogText").textContent = choice.response;

            // „Éú„Çø„É≥ÁÑ°ÂäπÂåñ
            document.querySelectorAll(".choiceBtn").forEach(btn => btn.disabled = true);

            // Ê¨°„ÅÆ„Çπ„ÉÜ„Éº„Ç∏„Å∏
            setTimeout(() => {
                gameState.currentStage++;
                if (gameState.currentStage >= gameState.totalStages) {
                    showEnding();
                } else {
                    startStage();
                }
            }, 2500);
        }

        // ========== „Ç®„É≥„Éá„Ç£„É≥„Ç∞ ==========
        function showEnding() {
            gameState.gameEnded = true;
            document.getElementById("overlay").style.display = "none";

            const percent = Math.round((gameState.childLightAmount / 100) * 100);
            let endingMessage = "";

            if (percent >= 90) {
                endingMessage = "‚ú® ÂÖâ„ÅØ„ÄÅ„Å§„ÅÑ„Å´ÂÆåÊàê„Åó„Åü„ÄÇ\n\n„ÅÇ„Å™„Åü„Å®„ÄÅÂ≠ê„Å©„ÇÇ„ÅÆËá™ÂàÜ„Åå„ÄÅ‰∏Ä„Å§„Å´„Å™„Å£„Åü„ÄÇ\n\nÂÖ®„Å¶„ÅÆÂÖâ„Åå„ÄÅ„ÅÇ„Å™„Åü„ÅÆ‰∏≠„Å´Ê∫∂„Åë„Åü„ÄÇ\n\n„Äå„ÇÇ„ÅÜ„ÄÅ„Å≤„Å®„Çä„Åò„ÇÉ„Å™„ÅÑ„ÄÇ„Äç\n\nÊúùÁÑº„Åë„Å´ÂåÖ„Åæ„Çå„Å¶„ÄÅ„ÅÇ„Å™„Åü„ÅØÂæÆÁ¨ë„ÇÄ„ÄÇ";
            } else if (percent >= 70) {
                endingMessage = "üåÖ Â§ú„ÅåÊòé„Åë„Åü„ÄÇ\n\nÈÅéÂéª„ÅÆËá™ÂàÜ„ÇÇ„ÄÅ‰ªä„ÅÆËá™ÂàÜ„ÇÇ„ÄÅÂÖ®ÈÉ®„ÅåÂ§ß‰∫ã„Å†„Å£„Åü„Çì„Å†„ÄÇ\n\n„Äå„ÅÇ„Çä„Åå„Å®„ÅÜ„ÄÇ„Äç\n\n„Åù„ÅÆÂëü„Åç„Åå„ÄÅÈ¢®„Å´‰πó„Çã„ÄÇ";
            } else if (percent >= 50) {
                endingMessage = "üå´Ô∏è Èúß„ÅåÊô¥„ÇåÂßã„ÇÅ„Åü„ÄÇ\n\nÂÖ®ÈÉ®„ÅåÂàÜ„Åã„Å£„Åü„Çè„Åë„Åò„ÇÉ„Å™„ÅÑ„ÄÇ„Åß„ÇÇ„ÄÅÊ≠©„ÅçÁ∂ö„Åë„Çã„Åì„Å®„Åå„Åß„Åç„Çã„ÄÇ\n\n„ÄåÂâç„Å´ÈÄ≤„ÇÇ„ÅÜ„ÄÇ„Äç";
            } else if (percent >= 30) {
                endingMessage = "‚≠ê Êòü„ÅåÂÖâ„Å£„Å¶„Çã„ÄÇ\n\n‰Ωï„ÇÇÂ§â„Çè„Çâ„Å™„Åã„Å£„Åü„ÅÆ„Åã„ÇÇ„Åó„Çå„Å™„ÅÑ„ÄÇ\n\n„Åß„ÇÇ„ÄÅ„Åì„Åì„Åã„ÇâÂßã„Åæ„Çã„Çì„Å†„ÄÇ";
            } else {
                endingMessage = "üíß Ê∂ô„Åå„Åì„Åº„Çå„Åü„ÄÇ\n\n„Åæ„Å†Áóõ„ÅÑ„ÄÇ„Åæ„Å†Ëã¶„Åó„ÅÑ„ÄÇ\n\n„Åß„ÇÇ„ÄÅ„Åù„ÅÆÊÑüÊÉÖ„ÇÇ„ÄÅÂÖ®ÈÉ®„ÅåËá™ÂàÜ„Å™„Çì„Å†„ÄÇ";
            }

            document.getElementById("endingMessage").textContent = endingMessage;
            document.getElementById("endingScreen").classList.add("show");
        }

        // ========== „Ç≠„É£„É≥„Éê„ÇπÊèèÁîª ==========
        const canvas = document.getElementById("gameCanvas");
        const ctx = canvas.getContext("2d");

        function resizeCanvas() {
            canvas.width = window.innerWidth;
            canvas.height = window.innerHeight;
        }

        function drawScene() {
            const stage = stages[gameState.currentStage];

            // ËÉåÊôØ
            ctx.fillStyle = stage.bgColor;
            ctx.fillRect(0, 0, canvas.width, canvas.height);

            // „Ç∞„É©„Éá„Éº„Ç∑„Éß„É≥ËÉåÊôØ
            const gradient = ctx.createLinearGradient(0, 0, 0, canvas.height);
            gradient.addColorStop(0, stage.bgColor);
            gradient.addColorStop(1, "#000");
            ctx.fillStyle = gradient;
            ctx.fillRect(0, 0, canvas.width, canvas.height);

            // Â≠ê„Å©„ÇÇ„ÅÆ„Ç∑„É´„Ç®„ÉÉ„ÉàÊèèÁîª
            drawChildSilhouette();

            // ÂÖâ„Ç®„Éï„Çß„ÇØ„Éà
            drawLightEffect();
        }

        function drawChildSilhouette() {
            const centerX = canvas.width / 2;
            const centerY = canvas.height / 2;

            const stage = stages[gameState.currentStage];
            const lightAmount = gameState.childLightAmount;

            // „Ç∑„É´„Ç®„ÉÉ„ÉàÔºöÂΩ±
            ctx.fillStyle = `rgba(0, 0, 0, ${0.6 + lightAmount / 500})`;

            // Â≠ê„Å©„ÇÇ„ÅÆÂΩ¢Ôºö„Ç∑„É≥„Éó„É´„Å™ÂÜÜÂΩ¢
            // È†≠
            ctx.beginPath();
            ctx.arc(centerX, centerY - 40, 25, 0, Math.PI * 2);
            ctx.fill();

            // ‰Ωì
            ctx.fillRect(centerX - 20, centerY - 15, 40, 50);

            // ËÖï
            ctx.fillRect(centerX - 35, centerY - 5, 15, 30);
            ctx.fillRect(centerX + 20, centerY - 5, 15, 30);

            // ËÑö
            ctx.fillRect(centerX - 12, centerY + 35, 10, 25);
            ctx.fillRect(centerX + 2, centerY + 35, 10, 25);

            // ÂÖâ„ÅÆËº™ÈÉ≠
            if (lightAmount > 20) {
                ctx.strokeStyle = `rgba(255, 215, 0, ${lightAmount / 200})`;
                ctx.lineWidth = 3;
                ctx.beginPath();
                ctx.arc(centerX, centerY, 70 + lightAmount / 2, 0, Math.PI * 2);
                ctx.stroke();
            }
        }

        function drawLightEffect() {
            const stage = stages[gameState.currentStage];
            const lightAmount = gameState.childLightAmount;
            const centerX = canvas.width / 2;
            const centerY = canvas.height / 2;

            // ÂÖâ„ÅÆÁ≤íÂ≠ê
            const particleCount = Math.floor(lightAmount / 10);
            for (let i = 0; i < particleCount; i++) {
                const angle = (i / particleCount) * Math.PI * 2;
                const distance = 100 + Math.sin(Date.now() / 500 + i) * 30;
                const x = centerX + Math.cos(angle) * distance;
                const y = centerY + Math.sin(angle) * distance;

                ctx.fillStyle = `rgba(255, 215, 0, ${lightAmount / 300})`;
                ctx.beginPath();
                ctx.arc(x, y, 3, 0, Math.PI * 2);
                ctx.fill();
            }

            // ‰∏≠Â§Æ„ÅÆÂÖâ„ÅÆÂÜÜ
            const radialGradient = ctx.createRadialGradient(centerX, centerY, 0, centerX, centerY, 150);
            radialGradient.addColorStop(0, `rgba(255, 215, 0, ${lightAmount / 300})`);
            radialGradient.addColorStop(1, `rgba(255, 215, 0, 0)`);
            ctx.fillStyle = radialGradient;
            ctx.fillRect(centerX - 150, centerY - 150, 300, 300);
        }

        function animationLoop() {
            drawScene();
            requestAnimationFrame(animationLoop);
        }

        // ========== „Ç§„Éô„É≥„Éà„É™„Çπ„Éä„Éº ==========
        document.getElementById("startBtn").addEventListener("click", () => {
            document.getElementById("titleScreen").classList.add("hidden");
            gameState.started = true;
            document.getElementById("overlay").style.display = "flex";
            startStage();
        });

        document.querySelectorAll(".choiceBtn").forEach(btn => {
            btn.addEventListener("click", (e) => {
                const choiceIndex = parseInt(e.target.dataset.choice);
                makeChoice(choiceIndex);
            });
        });

        document.getElementById("restartBtn").addEventListener("click", () => {
            location.reload();
        });

        window.addEventListener("resize", resizeCanvas);

        // ========== ÂàùÊúüÂåñ ==========
        resizeCanvas();
        animationLoop();

        // „Ç™„Éº„Éê„Éº„É¨„Ç§„ÇíÊúÄÂàù„ÅØÈùûË°®Á§∫
        document.getElementById("overlay").style.display = "none";
        document.getElementById("endingScreen").classList.remove("show");
    </script>
</body>
</html>